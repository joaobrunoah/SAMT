"use strict";var samtApp=angular.module("samtApp",["ngRoute","samtAnimations","samtControllers","parceiroControllers","projetoControllers","noticiaControllers","eventoControllers","samtFilters","samtServices","samtDirectives","textAngular"]);samtApp.config(["$routeProvider",function($routeProvider){$routeProvider.when("/inicio",{templateUrl:"partials/inicio.html",controller:"InicioCtrl"}).when("/quem_somos",{templateUrl:"partials/template_secao.html",controller:"QuemSomosCtrl"}).when("/parceiros",{templateUrl:"partials/parceiros.html",controller:"ParceirosCtrl"}).when("/parceiros/adicionar",{templateUrl:"partials/adicionar_elemento.html",controller:"AdicionarParceiroCtrl"}).when("/parceiros/editar/:parceiroId",{templateUrl:"partials/adicionar_elemento.html",controller:"EditarParceiroCtrl"}).when("/projetos",{templateUrl:"partials/multiple_elements.html",controller:"ProjetosCtrl"}).when("/projetos/adicionar",{templateUrl:"partials/adicionar_elemento.html",controller:"AdicionarProjetoCtrl"}).when("/projetos/editar/:projetoId",{templateUrl:"partials/adicionar_elemento.html",controller:"EditarProjetoCtrl"}).when("/projetos/:projetoId",{templateUrl:"partials/template_secao.html",controller:"SecaoProjetoCtrl"}).when("/noticias",{templateUrl:"partials/multiple_elements.html",controller:"NoticiasCtrl"}).when("/noticias/adicionar",{templateUrl:"partials/adicionar_elemento.html",controller:"AdicionarNoticiaCtrl"}).when("/noticias/editar/:noticiaId",{templateUrl:"partials/adicionar_elemento.html",controller:"EditarNoticiaCtrl"}).when("/noticias/:noticiaId",{templateUrl:"partials/template_secao.html",controller:"SecaoNoticiaCtrl"}).when("/eventos",{templateUrl:"partials/multiple_elements.html",controller:"EventosCtrl"}).when("/eventos/adicionar",{templateUrl:"partials/adicionar_elemento.html",controller:"AdicionarEventoCtrl"}).when("/eventos/editar/:eventoId",{templateUrl:"partials/adicionar_elemento.html",controller:"EditarEventoCtrl"}).when("/eventos/:eventoId",{templateUrl:"partials/template_secao.html",controller:"SecaoEventoCtrl"}).when("/trabalhe_conosco",{templateUrl:"partials/template_secao.html",controller:"TrabalheCtrl"}).when("/contato",{templateUrl:"partials/template_secao.html",controller:"ContatoCtrl"}).when("/loja",{templateUrl:"partials/template_secao.html",controller:"LojaCtrl"}).when("/administrador",{templateUrl:"partials/administrador.html",controller:"AdminCtrl"}).when("/admin",{redirectTo:"/administrador"}).otherwise({redirectTo:"/inicio"})}]);samtApp.run(function($http,$window){$http.defaults.headers.common["x-access-token"]=$window.localStorage.samtToken});var samtAnimations=angular.module("samtAnimations",["ngAnimate"]);samtAnimations.animation(".phone",function(){var animateUp=function(element,className,done){if(className!="active"){return}element.css({position:"absolute",top:500,left:0,display:"block"});jQuery(element).animate({top:0},done);return function(cancel){if(cancel){element.stop()}}};var animateDown=function(element,className,done){if(className!="active"){return}element.css({position:"absolute",left:0,top:0});jQuery(element).animate({top:-500},done);return function(cancel){if(cancel){element.stop()}}};return{addClass:animateUp,removeClass:animateDown}});"use strict";var samtControllers=angular.module("samtControllers",[]);samtControllers.controller("TopNavCtrl",["$scope","$location","AuthenticationService","$window","$http",function($scope,$location,AuthenticationService,$window,$http){$http.get("texts/texts.json").success(function(data){$scope.texts=data});$scope.getClass=function(path){if($location.path().substr(0,path.length)==path){return"active"}else{return""}};$scope.logoutAppear=function(){if(!AuthenticationService.isLogged&&$window.localStorage.samtToken&&$window.localStorage.expirationDate>=Date.now()){AuthenticationService.isLogged=true;return"appear"}if(AuthenticationService.isLogged){return"appear"}return""};$scope.userLogout=function(){if(AuthenticationService.isLogged){AuthenticationService.isLogged=false;delete $window.localStorage.samtToken;delete $window.localStorage.expirationDate}}}]);samtControllers.controller("InicioCtrl",["$scope","$http","$interval","Noticia","Projeto","Evento",function($scope,$http,$interval,Noticia,Projeto,Evento){var numberOfElements=0;$scope.abaNoticia=true;$scope.abaEvento=false;$scope.elementosCounter=0;$http.get("texts/texts.json").success(function(data){$scope.texts=data});$scope.noticias={};$scope.eventos={};$scope.elementos={};$scope.noticiaQuery=Noticia.query({limit:10},function(){for(var i=0;i<$scope.noticiaQuery.elementos.length;i++){var el=$scope.noticiaQuery.elementos[i];if(el.resumo===undefined||el.resumo==null||el.resumo=="undefined"){el.resumo=el.texto.substring(0,150)+"..."}$scope.noticiaQuery.elementos[i]=el}$scope.noticias=$scope.noticiaQuery.elementos;$scope.elementos=$scope.noticias;numberOfElements=$scope.elementos.length;$scope.activeElemento=$scope.elementos[0]._id});$scope.eventoQuery=Evento.query(function(){$scope.eventos=$scope.eventoQuery.elementos});$scope.projetos=Projeto.query(function(){var menorRand=1;var selectedProject=0;for(var i=0;i<$scope.projetos.length;i++){$scope.projetos[i].random=Math.random();if($scope.projetos[i].random<menorRand){menorRand=$scope.projetos[i].random;selectedProject=i}}$scope.activeProjeto=$scope.projetos[selectedProject]._id});$scope.ordenarPor="-data";$scope.selectAba=function(aba){if(aba=="noticia"){$scope.abaNoticia=true;$scope.abaEvento=false;$scope.elementos=$scope.noticias}else if(aba=="evento"){$scope.abaNoticia=false;$scope.abaEvento=true;$scope.elementos=$scope.eventos}else{$scope.abaNoticia=true;$scope.abaEvento=false;$scope.elementos=$scope.noticias}numberOfElements=$scope.elementos.length;$scope.activeElemento=$scope.elementos[0]._id};$scope.isElementoActive=function(idElemento){if(idElemento==$scope.activeElemento){return"active"}else{return""}};$scope.setElementoActive=function(elNumber){$scope.activeElemento=$scope.elementos[elNumber]._id;$scope.elementosCounter=elNumber;$interval.cancel($scope.iterateOverElementos);$scope.iterateOverElementos=$interval(function(){$scope.elementosCounter+=1;if($scope.elementosCounter>=$scope.elementos.length){$scope.elementosCounter=0}$scope.activeElemento=$scope.elementos[$scope.elementosCounter]._id;$interval.cancel($scope.iterateOverElementos);$scope.iterateOverElementos=$interval(function(){$scope.elementosCounter+=1;if($scope.elementosCounter>=$scope.elementos.length){$scope.elementosCounter=0}$scope.activeElemento=$scope.elementos[$scope.elementosCounter]._id},5e3)},2e4)};$scope.getElemento=function(){for(var i=0;i<$scope.elementos.length;i++){if($scope.elementos[i]._id==$scope.activeElemento){return $scope.elementos[i]}}return null};$scope.iterateOverElementos=$interval(function(){$scope.elementosCounter+=1;if($scope.elementosCounter>=numberOfElements){$scope.elementosCounter=0}$scope.activeElemento=$scope.elementos[$scope.elementosCounter]._id},5e3);$scope.iterateElementos=function(toLeft){$interval.cancel($scope.iterateOverElementos);if(toLeft==1){$scope.elementosCounter-=1;if($scope.elementosCounter<0){$scope.elementosCounter=numberOfElements-1}$scope.activeElemento=$scope.elementos[$scope.elementosCounter]._id}else{$scope.elementosCounter+=1;if($scope.elementosCounter>=numberOfElements){$scope.elementosCounter=0}$scope.activeElemento=$scope.elementos[$scope.elementosCounter]._id}$scope.iterateOverElementos=$interval(function(){$scope.elementosCounter-=1;if($scope.elementosCounter<0){$scope.elementosCounter=numberOfElements-1}$scope.activeElemento=$scope.elementos[$scope.elementosCounter]._id;$interval.cancel($scope.iterateOverElementos);$scope.iterateOverElementos=$interval(function(){$scope.elementosCounter-=1;if($scope.elementosCounter<0){$scope.elementosCounter=numberOfElements-1}$scope.activeElemento=$scope.elementos[$scope.elementosCounter]._id},5e3)},2e4)};$scope.isProjectActive=function(idProjeto){if(idProjeto==$scope.activeProjeto){return"active"}else{return""}};$scope.setProjectActive=function(idProjeto){$scope.activeProjeto=idProjeto};$scope.isLast=function($last,$first){if($last&&!$first){return"last"}return""};$scope.isMiddle=function($middle,$first){if($middle&&!$first){return"middle"}return""}}]);samtControllers.controller("QuemSomosCtrl",["$scope","$http","$sce","AuthenticationService",function($scope,$http,$sce,AuthenticationService){$http.get("texts/texts.json").success(function(data){$scope.titulo_secao=data.quem_somos;$scope.texto_secao=$sce.trustAsHtml(data.quem_somos_text);$scope.imagem_secao=data.quem_somos_imagem;$scope.distance_top=data.quem_somos_distance_top});$scope.mustAppear=function(subsecao){if(subsecao=="texto"){return"appear"}return""};$scope.isLoggedIn=function(){return AuthenticationService.isLogged}}]);samtControllers.controller("AdminCtrl",["$scope","$http","$window","$location","AuthenticationService","UserService","$route",function($scope,$http,$window,$location,AuthenticationService,UserService,$route){$http.get("texts/texts.json").success(function(data){$scope.texts=data});$scope.Login=function(credentials){var username=credentials.username;var password=credentials.password;if(username!==undefined&&password!==undefined){UserService.Login(username,password).success(function(data){AuthenticationService.isLogged=true;$window.localStorage.samtToken=data.samtToken;$http.defaults.headers.common["x-access-token"]=$window.localStorage.samtToken;$window.localStorage.expirationDate=data.expires;$window.localStorage.usuario=username;$location.path("/");$route.reload()}).error(function(status,data){alert(status)})}};$scope.isLoggedIn=function(){return AuthenticationService.isLogged};$scope.isAdmin=function(){return $window.localStorage.usuario=="admin"};$scope.passInfo={};$scope.passInfo.confirmacao="";$scope.userInfo={};$scope.userInfo.confirmacao="";$scope.mudarSenha=function(passInfo){if(passInfo.senhaNova!=passInfo.confirmacao){return}UserService.MudarSenha(passInfo.senhaAntiga,passInfo.senhaNova,$window.localStorage.usuario).success(function(data,status){alert(data)}).error(function(data,status){alert(data)})};$scope.adicionarUsuario=function(userInfo){if(userInfo.senha!=userInfo.confirmacao){return}UserService.AdicionarUsuario(userInfo.usuario,userInfo.senha).success(function(data,status){alert(data)}).error(function(data,status){alert(data)})}}]);samtControllers.controller("TrabalheCtrl",["$scope","$http","$sce","AuthenticationService",function($scope,$http,$sce,AuthenticationService){$http.get("texts/texts.json").success(function(data){$scope.titulo_secao=data.trabalhe_conosco;$scope.texto_secao=$sce.trustAsHtml(data.trabalhe_text);$scope.imagem_secao=data.trabalhe_imagem;$scope.distance_top=data.trabalhe_distance_top});$scope.mustAppear=function(subsecao){if(subsecao=="texto"){return"appear"}return""};$scope.isLoggedIn=function(){return AuthenticationService.isLogged}}]);samtControllers.controller("ContatoCtrl",["$scope","$http","$sce","AuthenticationService",function($scope,$http,$sce,AuthenticationService){$http.get("texts/texts.json").success(function(data){$scope.titulo_secao=data.contato;$scope.texto_secao=$sce.trustAsHtml(data.contato_text);$scope.imagem_secao=data.contato_imagem;$scope.distance_top=data.contato_distance_top});$scope.mustAppear=function(subsecao){if(subsecao=="texto"){return"appear"}return""};$scope.isLoggedIn=function(){return AuthenticationService.isLogged}}]);"use strict";var parceiroControllers=angular.module("parceiroControllers",[]);parceiroControllers.controller("ParceirosCtrl",["$scope","$interval","Parceiro","AuthenticationService","$route","$location",function($scope,$interval,Parceiro,AuthenticationService,$route,$location){$scope.appearDialog=false;$scope.scrollPos=0;$(window).on("scroll",function(){$scope.scrollPos=$(window).scrollTop();$scope.$apply()});var parceiros=Parceiro.query();$scope.parceirosArray=[];$interval(function(){var adicionarParceiro={imagemUrl:"img/site/adicionar.jpg",nome:"Adicionar Parceiro",url:"/#/parceiros/adicionar"};var parceirosTemp=[];var parceirosArrayTemp=[];var iMax=parceiros.length;if(iMax==0&&$scope.isLoggedIn()){parceirosTemp.push(adicionarParceiro);parceirosArrayTemp.push(parceirosTemp)}else{for(var i=0;i<iMax;i++){parceirosTemp.push(parceiros[i]);if(i>=iMax-1){if($scope.isLoggedIn()){if(i%3==2){parceirosArrayTemp.push(parceirosTemp);parceirosTemp=[];parceirosTemp.push(adicionarParceiro);parceirosArrayTemp.push(parceirosTemp)}else{parceirosTemp.push(adicionarParceiro);parceirosArrayTemp.push(parceirosTemp)}}else{parceirosArrayTemp.push(parceirosTemp)}}else if(i%3==2){parceirosArrayTemp.push(parceirosTemp);parceirosTemp=[]}}}$scope.parceirosArray=parceirosArrayTemp},100,10);$scope.isLoggedIn=function(){return AuthenticationService.isLogged};$scope.excluirParceiro=function(id){var objToRemove={};objToRemove.parceiroId=id;$scope.dialog_title="Excluir Parceiro";$scope.dialog_text="Tem certeza que deseja excluir este parceiro?";$scope.appearDialog=true;$("#dialog-confirm").dialog({resizable:false,height:200,modal:true,buttons:{Excluir:function(){$(this).dialog("close");Parceiro.delete(objToRemove,function(){$scope.parceiros=Parceiro.query();$route.reload()})},Cancelar:function(){$(this).dialog("close")}}})};$scope.editarParceiro=function(id){$location.path("/parceiros/editar/"+id);$route.reload()};$scope.dialogAppear=function(){return $scope.appearDialog}}]);parceiroControllers.controller("AdicionarParceiroCtrl",["$scope","$http","$window","$location","$route","elementUpload",function($scope,$http,$window,$location,$route,elementUpload){$scope.mustAppear=function(subsecao){if(subsecao=="form_parceiro"){return"appear"}return""};$http.get("texts/texts.json").success(function(data){$scope.texts=data});$scope.token=$window.localStorage.samtToken;$scope.info={};$scope.sendInfo=function(){elementUpload.postElement($scope.info,"/api/parceiros").success(function(){alert("Conteúdo Enviado com Sucesso");$location.path("/parceiros");$route.reload()}).error(function(err){console.log(err)})}}]);parceiroControllers.controller("EditarParceiroCtrl",["$scope","$http","$window","$location","$route","$routeParams","elementUpload","Parceiro",function($scope,$http,$window,$location,$route,$routeParams,elementUpload,Parceiro){var parceiroId=$routeParams.parceiroId;$scope.mustAppear=function(subsecao){if(subsecao=="form_parceiro"){return"appear"}return""};$http.get("texts/texts.json").success(function(data){$scope.texts=data});Parceiro.get({parceiroId:parceiroId},function(parceiro){$scope.info=parceiro;$scope.srcimagem=parceiro.imagemUrl});$scope.token=$window.localStorage.samtToken;$scope.sendInfo=function(){elementUpload.updateElement($scope.info,"/api/parceiros/"+parceiroId).success(function(){alert("Conteúdo Enviado com Sucesso");$location.path("/parceiros");$route.reload()})}}]);"use strict";var projetoControllers=angular.module("projetoControllers",[]);projetoControllers.controller("ProjetosCtrl",["$scope","$http","$interval","$location","Projeto","AuthenticationService","$route",function($scope,$http,$interval,$location,Projeto,AuthenticationService,$route){$scope.appearDialog=false;$scope.orderby={};$scope.orderby.options=[{name:"A -> Z",value:"nome"},{name:"Z -> A",value:"-nome"}];$scope.query={};$scope.query.orderby=$scope.orderby.options[0];$scope.query.limitTo=1e3;$scope.tipo_elemento="Projetos";$scope.tipo_url="projetos";var idElementSelected=null;$http.get("texts/texts.json").success(function(data){$scope.titulo_secao=data.projetos});$scope.elementos=Projeto.query(function(){if($scope.elementos!=undefined&&$scope.isLoggedIn()){for(var j=0;j<$scope.elementos.length;j++){if($scope.elementos[j].titulo.length>40)$scope.elementos[j].titulo=$scope.elementos[j].titulo.substring(0,39)+"..."}}});var mudarNomeParaTitulo=$interval(function(){var i=0;for(i=0;i<$scope.elementos.length;i++){$scope.elementos[i].titulo=$scope.elementos[i].nome}if(i!=0){$interval.cancel(mudarNomeParaTitulo)}},200,20);$scope.isElementSelected=function(id){if(id==idElementSelected){return"selected"}return""};$scope.selectElement=function(id){if(!$scope.isLoggedIn()){idElementSelected=id}};$scope.isLoggedIn=function(){return AuthenticationService.isLogged};$scope.excluirElemento=function(id){var objToRemove={};objToRemove.projetoId=id;$scope.dialog_title="Excluir Projeto";$scope.dialog_text="Tem certeza que deseja excluir este projeto?";$scope.appearDialog=true;$("#dialog-confirm").dialog({resizable:false,height:200,modal:true,buttons:{Excluir:function(){$(this).dialog("close");Projeto.delete(objToRemove,function(){$scope.elementos=Projeto.query();$route.reload()})},Cancelar:function(){$(this).dialog("close")}}})};$scope.editarElemento=function(id){$location.path("/projetos/editar/"+id);$route.reload()};$scope.dialogAppear=function(){return $scope.appearDialog}}]);projetoControllers.controller("SecaoProjetoCtrl",["$scope","$http","$routeParams","Projeto","htmlCompiler","galeriaFotos",function($scope,$http,$routeParams,Projeto,htmlCompiler,galeriaFotos){$http.get("texts/texts.json").success(function(data){$scope.texts=data});$scope.projeto=Projeto.get({projetoId:$routeParams.projetoId},function(projeto){$scope.imagem_secao=projeto.imagemUrl;$scope.titulo_secao=projeto.nome;$scope.texto_secao=htmlCompiler.compile(projeto.texto);$scope.distance_top=projeto.distanceTop;$scope.cursos_secao=projeto.cursos;$scope.galeria_fotos=projeto.fotos;if($scope.galeria_fotos==undefined){$scope.galeria_fotos=[]}for(var i=0;i<$scope.galeria_fotos.length;i++){$scope.galeria_fotos[i].appearName=!($scope.galeria_fotos[i].nome==""||$scope.galeria_fotos[i].nome==undefined)}$scope.galeria_fotos=galeriaFotos.transformarMatriz($scope.galeria_fotos)});$scope.mustAppear=function(item){if(item=="texto"){return"appear"}else if(item=="fotos"&&$scope.galeria_fotos!=[]&&$scope.galeria_fotos!=""&&$scope.galeria_fotos!=undefined){return"appear"}else if(item=="agenda"&&$scope.cursos_secao!=[]&&$scope.cursos_secao!=""&&$scope.cursos_secao!=undefined){return"appear"}return""};$scope.passouData=function(elemento){var dataElemento=new Date(elemento.data);if(dataElemento<=Date.now()){return false}return true}}]);projetoControllers.controller("AdicionarProjetoCtrl",["$scope","$http","$window","elementUpload","htmlCompiler","$location",function($scope,$http,$window,elementUpload,htmlCompiler,$location){$scope.mustAppear=function(item){if(item=="texto"||item=="preview"||item=="form_projeto"){return"appear"}return""};$http.get("texts/texts.json").success(function(data){$scope.texts=data});$scope.token=$window.localStorage.samtToken;$scope.info={};$scope.$watch("info.texto",function(newValue,oldValue){if($scope.info.texto!=undefined){$scope.info.texto_html=htmlCompiler.compile($scope.info.texto)}});$scope.sendInfo=function(){$scope.info.image=$scope.info.image_elemento;$scope.info.nome=$scope.info.titulo;elementUpload.postElement($scope.info,"/api/projetos").success(function(){alert("Conteúdo Enviado com Sucesso");$location.path("/projetos");$route.reload()})}}]);projetoControllers.controller("EditarProjetoCtrl",["$scope","$http","$location","$route","$routeParams","elementUpload","Projeto","htmlCompiler","$interval","galeriaFotos","AuthenticationService",function($scope,$http,$location,$route,$routeParams,elementUpload,Projeto,htmlCompiler,$interval,galeriaFotos,AuthenticationService){var projetoId=$routeParams.projetoId;$interval(function(){$(".curso_data").datetimepicker()},100,5);$scope.mustAppear=function(item){if(item=="texto"||item=="fotos"||item=="preview"||item=="form_projeto"||item=="agenda"){return"appear"}return""};$http.get("texts/texts.json").success(function(data){$scope.texts=data});Projeto.get({projetoId:projetoId},function(projeto){$scope.info=projeto;$scope.info.titulo=projeto.nome;$scope.srcimagem_elemento=projeto.imagemUrl;$scope.info.texto_html=htmlCompiler.compile($scope.info.texto);$scope.$watch("info.texto",function(newValue,oldValue){$scope.info.texto_html=htmlCompiler.compile($scope.info.texto)});$scope.info.cursos=projeto.cursos;if($scope.info.cursos==undefined){$scope.info.cursos=[]}$scope.info.fotos=projeto.fotos;if($scope.info.fotos==undefined){$scope.info.fotos=[]}$scope.info.fotosMatriz=galeriaFotos.transformarMatriz($scope.info.fotos)});$scope.sendInfo=function(){if($scope.info.texto==undefined){$scope.info.texto=""}if($scope.info.resumo==undefined){$scope.info.resumo=""}$scope.info.image=$scope.info.image_elemento;$scope.info.nome=$scope.info.titulo;$scope.info.fotos=galeriaFotos.transformarArray($scope.info.fotosMatriz);$scope.info.fotos=galeriaFotos.tratarNomeArquivos($scope.info.fotos,"projetos",projetoId);elementUpload.updateElement($scope.info,"/api/projetos/"+projetoId).success(function(){$http.put("/api/projetos/inserirarrays/"+projetoId,{cursos:$scope.info.cursos,fotos:$scope.info.fotos}).success(function(){alert("Conteúdo Enviado com Sucesso");$location.path("/projetos");$route.reload()})}).error(function(err){alert(err.message)})};$scope.inserirCurso=function(){$scope.info.cursos.push({data:"",bairro:"",local:""});$interval(function(){$(".curso_data").datetimepicker()},100,5)};$scope.addFoto=function(){$scope.info.fotos=galeriaFotos.transformarArray($scope.info.fotosMatriz);$scope.info.fotos.push({imagemUrl:"",nome:""});$scope.info.fotosMatriz=galeriaFotos.transformarMatriz($scope.info.fotos)};$scope.postImage=function(elemento){var image=elemento.files[0];elementUpload.uploadFoto(image,"projetos",projetoId)};$scope.isLoggedIn=function(){return AuthenticationService.isLogged};$scope.deleteFoto=function(foto){var index=$scope.info.fotos.indexOf(foto);$scope.info.fotos.splice(index,1);$scope.info.fotosMatriz=galeriaFotos.transformarMatriz($scope.info.fotos);var nomeFoto=galeriaFotos.getNomeFoto(foto);elementUpload.deleteFoto(nomeFoto,"projetos",projetoId)}}]);"use strict";var noticiaControllers=angular.module("noticiaControllers",[]);var filtroEntreDatas=function(elemento,query){var dataElemento=new Date(elemento.data);if(query.dataAntes!=undefined&&query.dataAntes!=""){var dataAntes=new Date(query.dataAntes);if(dataAntes>dataElemento){return false}}if(query.dataDepois!=undefined&&query.dataDepois!=""){var dataDepois=new Date(query.dataDepois);if(dataDepois<dataElemento){return false}}return true};noticiaControllers.controller("NoticiasCtrl",["$scope","$http","$location","Noticia","AuthenticationService","$route",function($scope,$http,$location,Noticia,AuthenticationService,$route){$("#query_from").datetimepicker();$("#query_to").datetimepicker();$scope.appearDialog=false;$scope.orderby={};$scope.orderby.options=[{name:"Mais Novas",value:"-data"},{name:"Mais Antigas",value:"data"}];$scope.query={};$scope.query.orderby=$scope.orderby.options[0];$scope.query.limitTo=10;$scope.offset={};$scope.offset.options=[{number:1}];$scope.query.offset=$scope.offset.options[0];$scope.tipo_elemento="Notícias";$scope.tipo_url="noticias";var idElementSelected=null;$http.get("texts/texts.json").success(function(data){$scope.titulo_secao=data.noticias;$scope.data_postado=data.data_postado});$scope.results=Noticia.query(function(){var count=$scope.results.count;var limit=$scope.query.limitTo;var numPages=count/limit;$scope.offset={};$scope.offset.options=[];$scope.elementos=$scope.results.elementos;for(var i=0;i<numPages;i++){$scope.offset.options.push({number:i+1})}if($scope.elementos!=undefined&&$scope.isLoggedIn()){for(var j=0;j<$scope.elementos.length;j++){if($scope.elementos[j].titulo.length>40)$scope.elementos[j].titulo=$scope.elementos[j].titulo.substring(0,39)+"..."}}$scope.query.offset=$scope.offset.options[0]});$scope.isElementSelected=function(id){if(id==idElementSelected){return"selected"}return""};$scope.selectElement=function(id){idElementSelected=id};$scope.isLoggedIn=function(){return AuthenticationService.isLogged};$scope.excluirElemento=function(id){var objToRemove={};objToRemove.noticiaId=id;$scope.dialog_title="Excluir Notícia";$scope.dialog_text="Tem certeza que deseja excluir esta notícia?";$scope.appearDialog=true;$("#dialog-confirm").dialog({resizable:false,height:200,modal:true,buttons:{Excluir:function(){$(this).dialog("close");Noticia.delete(objToRemove,function(){$scope.elementos=Noticia.query();$route.reload()})},Cancelar:function(){$(this).dialog("close")}}})};$scope.editarElemento=function(id){$location.path("/noticias/editar/"+id);$route.reload()};$scope.deAcordoQuery=function(elemento){var count=$scope.results.count;var limit=$scope.query.limitTo;var elementoIndex=getElementPosition(elemento);var offset=$scope.query.offset.number;var reverse=$scope.query.orderby.value=="-data";var filtroDatas=filtroEntreDatas(elemento,$scope.query);var filtroOffset=elementoIndex>=(offset-1)*limit&&!reverse||elementoIndex<count-(offset-1)*limit&&reverse;return filtroDatas&&filtroOffset};var getElementPosition=function(elemento){var elementos=$scope.results.elementos;for(var i=0;i<elementos.length;i++){if(elemento._id==elementos[i]._id){return i}}};$scope.dialogAppear=function(){return $scope.appearDialog}}]);noticiaControllers.controller("SecaoNoticiaCtrl",["$scope","$http","$routeParams","Noticia","htmlCompiler","galeriaFotos",function($scope,$http,$routeParams,Noticia,htmlCompiler,galeriaFotos){$http.get("texts/texts.json").success(function(data){$scope.texts=data});$scope.elemento=Noticia.get({noticiaId:$routeParams.noticiaId},function(noticia){$scope.imagem_secao=noticia.imagemUrl;$scope.titulo_secao=noticia.titulo;$scope.data_secao=noticia.data;$scope.texto_secao=htmlCompiler.compile(noticia.texto);$scope.distance_top=noticia.distanceTop;$scope.galeria_fotos=noticia.fotos;if($scope.galeria_fotos==undefined){$scope.galeria_fotos=[]}for(var i=0;i<$scope.galeria_fotos.length;i++){$scope.galeria_fotos[i].appearName=!($scope.galeria_fotos[i].nome==""||$scope.galeria_fotos[i].nome==undefined)}$scope.galeria_fotos=galeriaFotos.transformarMatriz($scope.galeria_fotos)});$scope.mustAppear=function(item){if(item=="texto"||item=="data"){return"appear"}else if(item=="fotos"&&$scope.galeria_fotos!=[]&&$scope.galeria_fotos!=""&&$scope.galeria_fotos!=undefined){return"appear"}return""}}]);noticiaControllers.controller("AdicionarNoticiaCtrl",["$scope","$http","$location","$window","elementUpload","htmlCompiler",function($scope,$http,$location,$window,elementUpload,htmlCompiler){$scope.mustAppear=function(item){if(item=="texto"||item=="data"||item=="preview"||item=="form_noticia"){return"appear"}return""};$http.get("texts/texts.json").success(function(data){$scope.texts=data});$scope.token=$window.localStorage.samtToken;$scope.dataAtual=Date.now();$scope.info={};$scope.$watch("info.texto",function(newValue,oldValue){if($scope.info.texto!=undefined){$scope.info.texto_html=htmlCompiler.compile($scope.info.texto)}});$scope.sendInfo=function(){$scope.info.image=$scope.info.image_elemento;elementUpload.postElement($scope.info,"/api/noticias").success(function(){alert("Conteúdo Enviado com Sucesso");$location.path("/noticias");$route.reload()})}}]);noticiaControllers.controller("EditarNoticiaCtrl",["$scope","$http","$location","$route","$routeParams","elementUpload","Noticia","htmlCompiler","galeriaFotos","AuthenticationService",function($scope,$http,$location,$route,$routeParams,elementUpload,Noticia,htmlCompiler,galeriaFotos,AuthenticationService){var noticiaId=$routeParams.noticiaId;$scope.mustAppear=function(item){if(item=="texto"||item=="fotos"||item=="data"||item=="preview"||item=="form_noticia"){return"appear"}return""};$http.get("texts/texts.json").success(function(data){$scope.texts=data});Noticia.get({noticiaId:noticiaId},function(noticia){$scope.info=noticia;$scope.srcimagem_elemento=noticia.imagemUrl;$scope.dataAtual=noticia.data;$scope.info.texto_html=htmlCompiler.compile($scope.info.texto);$scope.$watch("info.texto",function(newValue,oldValue){$scope.info.texto_html=htmlCompiler.compile($scope.info.texto)})});$scope.sendInfo=function(){if($scope.info.texto==undefined){$scope.info.texto=""}if($scope.info.resumo==undefined){$scope.info.resumo=""}$scope.info.image=$scope.info.image_elemento;$scope.info.fotos=galeriaFotos.transformarArray($scope.info.fotosMatriz);$scope.info.fotos=galeriaFotos.tratarNomeArquivos($scope.info.fotos,"noticias",noticiaId);elementUpload.updateElement($scope.info,"/api/noticias/"+noticiaId).success(function(){$http.put("/api/noticias/inserirarrays/"+noticiaId,{fotos:$scope.info.fotos}).success(function(){alert("Conteúdo Enviado com Sucesso");$location.path("/noticias");$route.reload()})}).error(function(err){alert(err.message)})};$scope.addFoto=function(){$scope.info.fotos=galeriaFotos.transformarArray($scope.info.fotosMatriz);$scope.info.fotos.push({imagemUrl:"",nome:""});$scope.info.fotosMatriz=galeriaFotos.transformarMatriz($scope.info.fotos)};$scope.postImage=function(elemento){var image=elemento.files[0];elementUpload.uploadFoto(image,"noticias",noticiaId)};$scope.isLoggedIn=function(){return AuthenticationService.isLogged};$scope.deleteFoto=function(foto){elementUpload.deleteFoto(foto,"noticias",noticiaId).success(function(){$route.reload()})}}]);"use strict";var eventoControllers=angular.module("eventoControllers",[]);var filtroEntreDatas=function(elemento,query){var dataElemento=new Date(elemento.data);if(query.dataAntes!=undefined&&query.dataAntes!=""){var dataAntes=new Date(query.dataAntes);if(dataAntes>dataElemento){return false}}if(query.dataDepois!=undefined&&query.dataDepois!=""){var dataDepois=new Date(query.dataDepois);if(dataDepois<dataElemento){return false}}return true};eventoControllers.controller("EventosCtrl",["$scope","$http","$location","Evento","AuthenticationService","$route",function($scope,$http,$location,Evento,AuthenticationService,$route){$("#query_from").datetimepicker();$("#query_to").datetimepicker();$scope.appearDialog=false;$scope.orderby={};$scope.orderby.options=[{name:"Mais Novas",value:"-data"},{name:"Mais Antigas",value:"data"}];$scope.query={};$scope.query.orderby=$scope.orderby.options[0];$scope.query.limitTo=10;$scope.offset={};$scope.offset.options=[{number:1}];$scope.query.offset=$scope.offset.options[0];$scope.tipo_elemento="Eventos";$scope.tipo_url="eventos";var idElementSelected=null;$http.get("texts/texts.json").success(function(data){$scope.titulo_secao=data.eventos});$scope.results=Evento.query(function(){var count=$scope.results.count;var limit=$scope.query.limitTo;var numPages=count/limit;$scope.offset={};$scope.offset.options=[];$scope.elementos=$scope.results.elementos;for(var i=0;i<numPages;i++){$scope.offset.options.push({number:i+1})}if($scope.elementos!=undefined&&$scope.isLoggedIn()){for(var j=0;j<$scope.elementos.length;j++){if($scope.elementos[j].titulo.length>40)$scope.elementos[j].titulo=$scope.elementos[j].titulo.substring(0,39)+"..."}}$scope.query.offset=$scope.offset.options[0]});$scope.isElementSelected=function(id){if(id==idElementSelected){return"selected"}return""};$scope.selectElement=function(id){idElementSelected=id};$scope.isLoggedIn=function(){return AuthenticationService.isLogged};$scope.excluirElemento=function(id){var objToRemove={};objToRemove.eventoId=id;$scope.dialog_title="Excluir Evento";$scope.dialog_text="Tem certeza que deseja excluir este evento?";$scope.appearDialog=true;$("#dialog-confirm").dialog({resizable:false,height:200,modal:true,buttons:{Excluir:function(){$(this).dialog("close");Evento.delete(objToRemove,function(){$scope.elementos=Evento.query();$route.reload()})},Cancelar:function(){$(this).dialog("close")}}})};$scope.editarElemento=function(id){$location.path("/eventos/editar/"+id);$route.reload()};$scope.deAcordoQuery=function(elemento){var count=$scope.results.count;var limit=$scope.query.limitTo;var elementoIndex=getElementPosition(elemento);var offset=$scope.query.offset.number;var reverse=$scope.query.orderby.value=="-data";var filtroDatas=filtroEntreDatas(elemento,$scope.query);var filtroOffset=elementoIndex>=(offset-1)*limit&&!reverse||elementoIndex<count-(offset-1)*limit&&reverse;return filtroDatas&&filtroOffset};var getElementPosition=function(elemento){
var elementos=$scope.results.elementos;for(var i=0;i<elementos.length;i++){if(elemento._id==elementos[i]._id){return i}}};$scope.dialogAppear=function(){return $scope.appearDialog}}]);eventoControllers.controller("SecaoEventoCtrl",["$scope","$http","$routeParams","Evento","htmlCompiler","galeriaFotos",function($scope,$http,$routeParams,Evento,htmlCompiler,galeriaFotos){$http.get("texts/texts.json").success(function(data){$scope.texts=data});$scope.evento=Evento.get({eventoId:$routeParams.eventoId},function(evento){$scope.imagem_secao=evento.imagemUrl;$scope.titulo_secao=evento.titulo;$scope.texto_secao=htmlCompiler.compile(evento.texto);$scope.local_secao=evento.local;$scope.data_secao=evento.data;$scope.distance_top=evento.distanceTop;$scope.galeria_fotos=evento.fotos;if($scope.galeria_fotos==undefined){$scope.galeria_fotos=[]}for(var i=0;i<$scope.galeria_fotos.length;i++){$scope.galeria_fotos[i].appearName=!($scope.galeria_fotos[i].nome==""||$scope.galeria_fotos[i].nome==undefined)}$scope.galeria_fotos=galeriaFotos.transformarMatriz($scope.galeria_fotos)});$scope.mustAppear=function(item){if(item=="texto"||item=="info"){return"appear"}else if(item=="fotos"&&$scope.galeria_fotos!=[]&&$scope.galeria_fotos!=""&&$scope.galeria_fotos!=undefined){return"appear"}return""}}]);eventoControllers.controller("AdicionarEventoCtrl",["$scope","$http","$window","elementUpload","htmlCompiler","$location",function($scope,$http,$window,elementUpload,htmlCompiler,$location){$("#data").datetimepicker();$scope.mustAppear=function(item){if(item=="texto"||item=="info"||item=="preview"||item=="form_evento"){return"appear"}return""};$http.get("texts/texts.json").success(function(data){$scope.texts=data});$scope.token=$window.localStorage.samtToken;$scope.info={};$scope.$watch("info.texto",function(newValue,oldValue){if($scope.info.texto!=undefined){$scope.info.texto_html=htmlCompiler.compile($scope.info.texto)}});$scope.sendInfo=function(){$scope.info.image=$scope.info.image_elemento;elementUpload.postElement($scope.info,"/api/eventos").success(function(){alert("Conteúdo Enviado com Sucesso");$location.path("/eventos");$route.reload()})}}]);projetoControllers.controller("EditarEventoCtrl",["$scope","$http","$location","$route","$routeParams","elementUpload","Evento","htmlCompiler","galeriaFotos","AuthenticationService",function($scope,$http,$location,$route,$routeParams,elementUpload,Evento,htmlCompiler,galeriaFotos,AuthenticationService){$("#data").datetimepicker();var eventoId=$routeParams.eventoId;$scope.mustAppear=function(item){if(item=="texto"||item=="fotos"||item=="info"||item=="preview"||item=="form_evento"){return"appear"}return""};$http.get("texts/texts.json").success(function(data){$scope.texts=data});Evento.get({eventoId:eventoId},function(evento){$scope.info=evento;$scope.srcimagem_elemento=evento.imagemUrl;$scope.info.texto_html=htmlCompiler.compile($scope.info.texto);$scope.$watch("info.texto",function(newValue,oldValue){$scope.info.texto_html=htmlCompiler.compile($scope.info.texto)})});$scope.sendInfo=function(){if($scope.info.texto==undefined){$scope.info.texto=""}if($scope.info.resumo==undefined){$scope.info.resumo=""}$scope.info.image=$scope.info.image_elemento;$scope.info.fotos=galeriaFotos.transformarArray($scope.info.fotosMatriz);$scope.info.fotos=galeriaFotos.tratarNomeArquivos($scope.info.fotos,"eventos",eventoId);elementUpload.updateElement($scope.info,"/api/eventos/"+eventoId).success(function(){$http.put("/api/eventos/inserirarrays/"+eventoId,{fotos:$scope.info.fotos}).success(function(){alert("Conteúdo Enviado com Sucesso");$location.path("/eventos");$route.reload()})}).error(function(err){alert(err.message)})};$scope.addFoto=function(){$scope.info.fotos=galeriaFotos.transformarArray($scope.info.fotosMatriz);$scope.info.fotos.push({imagemUrl:"",nome:""});$scope.info.fotosMatriz=galeriaFotos.transformarMatriz($scope.info.fotos)};$scope.postImage=function(elemento){var image=elemento.files[0];elementUpload.uploadFoto(image,"eventos",eventoId)};$scope.isLoggedIn=function(){return AuthenticationService.isLogged};$scope.deleteFoto=function(foto){elementUpload.deleteFoto(foto,"eventos",eventoId).success(function(){$route.reload()})}}]);"use strict";var samtDirectives=angular.module("samtDirectives",[]);samtDirectives.directive("fileread",[function(){return{scope:{fileread:"="},link:function(scope,element,attributes){element.bind("change",function(changeEvent){var reader=new FileReader;reader.onload=function(loadEvent){scope.$apply(function(){scope.fileread=loadEvent.target.result})};reader.readAsDataURL(changeEvent.target.files[0])})}}}]);samtDirectives.directive("fileModel",["$parse",function($parse){return{restrict:"A",link:function(scope,element,attrs){var model=$parse(attrs.fileModel);var modelSetter=model.assign;element.bind("change",function(){scope.$apply(function(){modelSetter(scope,element[0].files[0])})})}}}]);"use strict";angular.module("samtFilters",[]).filter("checkmark",function(){return function(input){return input?"✓":"✘"}});"use strict";var samtServices=angular.module("samtServices",["ngResource"]);samtServices.factory("AuthenticationService",function(){var auth={isLogged:false};return auth});samtServices.factory("Parceiro",["$resource",function($resource){return $resource("/api/parceiros/:parceiroId",{},{delete:{method:"DELETE",params:{parceiroId:"parceiroId"}}})}]);samtServices.factory("Projeto",["$resource",function($resource){return $resource("/api/projetos/:projetoId",{},{get:{method:"GET",params:{projetoId:"projetoId"},isArray:false}})}]);samtServices.factory("Noticia",["$resource",function($resource){return $resource("/api/noticias/:noticiaId",{},{query:{method:"GET",isArray:false},get:{method:"GET",params:{noticiaId:"noticiaId"},isArray:false}})}]);samtServices.factory("Evento",["$resource",function($resource){return $resource("/api/eventos/:eventoId",{},{query:{method:"GET",isArray:false},get:{method:"GET",params:{eventoId:"eventoId"},isArray:false}})}]);samtServices.factory("UserService",function($http){return{Login:function(username,password){return $http.post("/api/login",{username:username,password:password})},Logout:function(){},MudarSenha:function(senhaAntiga,senhaNova,usuario){return $http.put("api/user/mudar_senha",{senha_nova:senhaNova,senha_antiga:senhaAntiga,usuario:usuario})},AdicionarUsuario:function(usuario,senha){return $http.post("api/user/add",{usuario:usuario,senha:senha})}}});samtServices.service("elementUpload",["$http",function($http){this.postElement=function(info,uploadUrl){var formData=new FormData;formData.append("image",info.image);formData.append("nome",info.nome);formData.append("url",info.url);formData.append("titulo",info.titulo);formData.append("resumo",info.resumo);formData.append("texto",info.texto);formData.append("local",info.local);formData.append("data",info.data);formData.append("distanceTop",info.distanceTop);return $http.post(uploadUrl,formData,{transformRequest:angular.identity,headers:{"Content-Type":undefined}})};this.updateElement=function(info,uploadUrl){var formData=new FormData;if(info.image!=undefined){formData.append("image",info.image)}formData.append("nome",info.nome);formData.append("url",info.url);formData.append("titulo",info.titulo);formData.append("resumo",info.resumo);formData.append("texto",info.texto);formData.append("local",info.local);formData.append("data",info.data);formData.append("distanceTop",info.distanceTop);return $http.put(uploadUrl,formData,{transformRequest:angular.identity,headers:{"Content-Type":undefined}})};this.uploadFoto=function(image,tipo,id){var formData=new FormData;formData.append("image",image);return $http.post("/api/"+tipo+"/imagem/"+id,formData,{transformRequest:angular.identity,headers:{"Content-Type":undefined}})};this.deleteFoto=function(nomeFoto,tipo,id){return $http.delete("/api/"+tipo+"/imagem/"+id+"/"+nomeFoto)}}]);samtServices.service("htmlCompiler",["$sce",function($sce){this.compile=function(text){text=text.replace(/\n/g,"<br/>");return $sce.trustAsHtml(text)}}]);samtServices.service("galeriaFotos",[function(){this.gerarUrlImagem=function(foto,tipo,id){if(foto.imagem_elemento!=undefined){foto.imagemUrl="img/"+tipo+"/"+id+"/"+foto.imagem_elemento.name}return foto.imagemUrl};this.getNomeFoto=function(foto){if(foto.imagem_elemento!=undefined){return foto.imagem_elemento.name}return foto.imagemUrl.substring(foto.imagemUrl.lastIndexOf("/")+1,foto.imagemUrl.length)};this.tratarNomeArquivos=function(fotos,tipo,id){var novoFotos=[];if(fotos!=undefined){for(var i=0;i<fotos.length;i++){var foto={};foto.nome=fotos[i].nome;foto.imagemUrl=this.gerarUrlImagem(fotos[i],tipo,id);novoFotos.push(foto)}}return novoFotos};this.transformarMatriz=function(elementos){var array=[];var subarray=[];if(elementos!=undefined){for(var i=0;i<elementos.length;i++){subarray.push(elementos[i]);if(subarray.length>=3){array.push(subarray);subarray=[]}}if(subarray.length>0){array.push(subarray)}}return array};this.transformarArray=function(matriz){var array=[];var linha=[];if(matriz!=undefined){for(var i=0;i<matriz.length;i++){linha=matriz[i];for(var j=0;j<linha.length;j++){array.push(linha[j])}}}return array}}]);